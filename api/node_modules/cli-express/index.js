#!/usr/bin/env node
const { program, Argument } = require("commander");
const chalk = require("chalk");

const { actionRunner, configAction, generateAction, initAction } = require("./actions");
const { checkExpressProject } = require("./helpers");

program
    .version("1.0.0")
    .description("Express CLI. A tool to improve your Express.js development experience.")

program
    .command('config')
    .alias('c')
    .description('Configure the project')
    .hook('preAction', checkExpressProject)
    .action(configAction);

program
    .command('generate')
    .alias('g')
    .description('Generate all the staff to work with Express.js')
    .addArgument(
        new Argument('<action>', 'You can choose wich resource you want to generate')
            .choices(['all', 'model', 'controller', 'route'])
    )
    .hook('preAction', checkExpressProject)
    .action(actionRunner(generateAction));

program
    .command('init')
    .alias('i')
    .description('Initialize the project')
    .hook('preAction', checkExpressProject)
    .action(initAction);

try {
    program.parse(process.argv);
} catch (error) {
    console.log(error.stack);
    console.error(chalk.red.bold(error.message));
}